#summary WASAPI排他モード
#labels Featured

WASAPI排他モードは、Windows Vista以降で使える(Windows7推奨)
高音質低レイテンシのPCM音声再生・録音APIです。

=WASAPI排他モードの実験プログラム=

  * 再生プログラム PlayPcmWin
  * 録音プログラム RecPcmWin
  * C#からWASAPIを使うためのクラスWasapiCSについて [http://code.google.com/p/bitspersampleconv2/wiki/WasapiCS WasapiCS]

=資料=

  * 共有モードの再生 http://msdn.microsoft.com/en-us/library/dd316756%28v=VS.85%29.aspx
  * 共有モードの録音 http://msdn.microsoft.com/en-us/library/dd370800%28v=VS.85%29.aspx
  * 排他モードについての資料 http://msdn.microsoft.com/en-us/library/dd370844%28v=VS.85%29.aspx
  * サンプルプログラム、バグ情報等 http://blogs.msdn.com/b/matthew_van_eerde/archive/tags/audio/

=Windows 7で追加された(Windows Vistaで使えない)機能について=

  * 録音時に、音切れが発生したかどうかを知る機能 AUDCLNT_BUFFERFLAGS_DATA_DISCONTINUITY
  * S/PDIFのコピー禁止フラグを立てる機能
  * HDMIのHDCPを有効にする機能
  * デジタル出力を無効にする機能

=デバイスごとの使用可能なPCMデータフォーマット一覧 (再生の場合)=

使用可能なフォーマット(サンプリング周波数と量子化ビット数の組み合わせ)は
デバイスごとに異なります。

以下の表でOKと書いてあっても、使えなかったり機能に制限がある場合があります。
  * Realtekは、Realtekドライバをアンインストールして、Windows標準ドライバを入れると、使えるフォーマットが増えるらしいです。
  * Creative X-FiTiHDの44.1kHz 16bit出力は、イベント駆動モードで動作できない。タイマー駆動モードならば動作する。
  * Creative X-FiTiHDはS/PDIF出力から量子化ビット数24ビット出力が可能です。
  * RME Fireface400とM-AUDIO !ProFire2626は、機器に設定されているマスターサンプリングレートのみ使用できる。マスターサンプリングレートはコントロールパネルで変更できる。ASIOではマスターサンプリングレート以外のサンプリング周波数に設定可能。
  * M-AUDIO ProFire 2626のS/PDIF出力は、量子化ビット数24ビット出力の場合にコピープロテクトがかかるようです。
  * RME Fireface400は、ASIOでは量子化ビット数24ビットが使用できるがWASAPIでは選択できない。
  * Prodigy HD2はS/PDIF出力に量子化ビット数24ビットのデータを入れると出力に量子化ビット数16ビットのデータが出てきます。

表1: 使用可能なフォーマット一覧
{{{
スピーカー (Realtek High Definition Audio) (Realtek ALC889A Realtekドライバ)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: ok 0x00000000
88200Hz 16bit: na 0x88890008
96000Hz 16bit: ok 0x00000000
176400Hz 16bit: na 0x88890008
192000Hz 16bit: ok 0x00000000
44100Hz 32bit: na 0x88890008
48000Hz 32bit: na 0x88890008
88200Hz 32bit: na 0x88890008
96000Hz 32bit: na 0x88890008
176400Hz 32bit: na 0x88890008
192000Hz 32bit: na 0x88890008

スピーカー (Creative SB X-Fi) (Creative X-Fi Ti HD)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: ok 0x00000000
88200Hz 16bit: ok 0x00000000
96000Hz 16bit: ok 0x00000000
176400Hz 16bit: ok 0x00000000
192000Hz 16bit: ok 0x00000000
44100Hz 32bit: ok 0x00000000
48000Hz 32bit: ok 0x00000000
88200Hz 32bit: ok 0x00000000
96000Hz 32bit: ok 0x00000000
176400Hz 32bit: ok 0x00000000
192000Hz 32bit: ok 0x00000000

スピーカー (Prodigy HD2 Audio)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: ok 0x00000000
88200Hz 16bit: ok 0x00000000
96000Hz 16bit: ok 0x00000000
176400Hz 16bit: ok 0x00000000
192000Hz 16bit: ok 0x00000000
44100Hz 32bit: ok 0x00000000
48000Hz 32bit: ok 0x00000000
88200Hz 32bit: ok 0x00000000
96000Hz 32bit: ok 0x00000000
176400Hz 32bit: ok 0x00000000
192000Hz 32bit: ok 0x00000000

Multichannel (M-Audio ProFire 2626)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: na 0x88890008
88200Hz 16bit: na 0x88890008
96000Hz 16bit: na 0x88890008
176400Hz 16bit: na 0x88890008
192000Hz 16bit: na 0x88890008
44100Hz 32bit: ok 0x00000000
48000Hz 32bit: na 0x88890008
88200Hz 32bit: na 0x88890008
96000Hz 32bit: na 0x88890008
176400Hz 32bit: na 0x88890008
192000Hz 32bit: na 0x88890008

スピーカー (RME Fireface 400)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: na 0x88890008
88200Hz 16bit: na 0x88890008
96000Hz 16bit: na 0x88890008
176400Hz 16bit: na 0x88890008
192000Hz 16bit: na 0x88890008
44100Hz 32bit: na 0x88890008
48000Hz 32bit: na 0x88890008
88200Hz 32bit: na 0x88890008
96000Hz 32bit: na 0x88890008
176400Hz 32bit: na 0x88890008
192000Hz 32bit: na 0x88890008 

デジタル出力 (E-MU 0404 | USB)
44100Hz 16bit: ok 0x00000000
48000Hz 16bit: ok 0x00000000
88200Hz 16bit: ok 0x00000000
96000Hz 16bit: ok 0x00000000
176400Hz 16bit: ok 0x00000000
192000Hz 16bit: ok 0x00000000
44100Hz 32bit: na 0x88890008
48000Hz 32bit: na 0x88890008
88200Hz 32bit: na 0x88890008
96000Hz 32bit: na 0x88890008
176400Hz 32bit: na 0x88890008
192000Hz 32bit: na 0x88890008
}}}