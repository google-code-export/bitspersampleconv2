#summary 矩形波の入ったWAVファイルを出力するツールSqWave2
#labels Featured


= 説明 =

!SqWave2は矩形波の入ったWAVファイルを出力するツールです。

!WaveGene 1.40の矩形波出力波形に納得いかない感じだったので作りました。

= 使用方法 =

http://bitspersampleconv2.googlecode.com/files/SqWave10008.zip
をダウンロードして、中に入っているsetup.exeを実行するとインストールされます。

デスクトップに!SqWave2という名前のショートカットが作られますのでこれをダブルクリックします。あとは画面の指示に従ってWAVファイルを出力します。

アンインストールは、コントロールパネルの[プログラムと機能]から!SqWave2を選んでアンインストールを選択するとできます。

既に旧バージョンの!SqWaveがインストールされている状態で、
最新バージョンに更新したい場合、
最新バージョンをインストールする前に旧バージョンを手動でアンインストールする必要はありません。
最新バージョンを普通にインストールすると、インストーラーが全自動で旧バージョンをアンインストールしてから最新バージョンをインストールします。さらに言うと、この場合zipの中に入っているsetup.exeではなく!SqWave2Setup.msiをダブルクリックしてインストールすると、.NET Framework 4がPCに入っているかどうかをチェックしないので、インストールが早くできて良いです。

もしかすると、予め以下の場所からVisual C++ 2010ランタイムライブラリをダウンロードしてインストールする必要があるかもしれません。

32ビット Windows用: http://www.microsoft.com/downloads/details.aspx?familyid=a7b7a05e-6de6-4d3a-a423-37bf0912db84&displaylang=ja

64ビットWindows用: http://www.microsoft.com/downloads/details.aspx?familyid=bd512d9e-43c8-4655-81bf-9350143d5867&displaylang=ja 

http://bitspersampleconv2.googlecode.com/files/SqWave10008ss.png

==ASIO出力動作確認デバイス==

以下のASIOデバイスでは動作しました
 * M-AUDIO !ProFire 2626
 * Realtek ASIO

以下のASIOデバイスでは動作しませんでした
 * ASIO4ALL …なぜか間欠的に音が鳴る

== !SqWave2と!WaveGeneの出力波形とスペクトル ==

http://bitspersampleconv2.googlecode.com/files/raw.png

↑*図1* 出力データの比較(192kHzサンプリング、矩形波、10kHz、-10dB)

図1は出力データをそのままグラフにプロットしたもので、縦軸がサンプル値、横軸が時間です。
赤い＋点が!SqWave2の出力データ、緑の×点が!WaveGeneの出力データです。
グラフの一番左 0のところは0サンプル目(最初のサンプル値)です。DACのアナログ出力にこの波形が出るわけではないです。(DACの出力波形の綺麗さについては図2で比較できます。)

http://bitspersampleconv2.googlecode.com/files/8x.png

↑*図2* 図1のデータの8倍オーバーサンプリング処理後の出力データの比較

縦軸がサンプル値、横軸が時間です。
出力レベルが小さい赤い線が!SqWave2の出力データ、
出力レベルが大きい緑の線が!WaveGeneの出力データです。
グラフの一番左 0のところは0サンプル目(最初のサンプル値)です。

DACのアナログ出力からは、大体図2のような波形が出ます。
!SqWave2の出力波形は!WaveGeneよりも安定しています。

最初の半波長ぐらいはどちらも波形が乱れています

なお、オーバーサンプリングはsndfile-resampleを用いて以下のようにして行いました。
sndfile-resampleは極めて高精度なリサンプルができるのでおすすめです。
{{{
sndfile-resample -by 8 -c 0 SQ10K_192.wav SQ10K_1536.wav
sndfile-resample -by 8 -c 0 WG10K_192.wav WG10K_1536.wav
}}}

http://bitspersampleconv2.googlecode.com/files/spectrum.png

↑*図3* !SqWave2の出力データのスペクトログラム

http://bitspersampleconv2.googlecode.com/files/spectrum_wg.png

↑*図4* !WaveGeneの出力データのスペクトログラム

!WaveGeneの出力データはエイリアシング歪が生じています。
これだけ大きな音量で関係ない周波数成分が含まれていると、耳で聞いてもわかります。

= 開発方法 =

このプログラムは.NET Framework 4を使用して作りました。

Visual Studio 2010が必要です。

TortoiseSVNなどを使って https://bitspersampleconv2.googlecode.com/svn/trunk をチェックアウトします

チェックアウトしてきたツリーにASIO SDKをunzipしたものをコピーして 同じ親ディレクトリのなかにASIOSDK2とAsioIOがある状態にして AsioIO\AsioIODLL\copyasiofiles.batを実行するとASIOSDKの中から asio.cppなど9つのファイルをAsioIO\AsioIODLL\にコピーします

Visual Studio 2010でsqwave2.slnを開いてF5でビルドして実行します 

= 更新履歴 =

=== !SqWave2 バージョン 1.0.8 ===
  * ASIO出力対応。

=== !SqWave2 バージョン 1.0.4 ===
  * 級数加算打ち切り周波数をナイキスト周波数との比の％で入力できるようにしました。

=== !SqWave2 バージョン 1.0.2 ===
  * のこぎり波、三角波もでるようにしました。

=== !SqWave2 バージョン 1.0.1 ===
  * ダイアログに入れられた値の範囲チェック。
  * マルチコア対応。Intel Core i7-980Xでの実行結果。見事にすべてのCPUコアに負荷が分散していますｗ

http://bitspersampleconv2.googlecode.com/files/taskman.png

=== !SqWave2 バージョン 1.0.0 ===
  * 新規作成

=== !SqWave1 バージョン 1.0.0 ===
  * 新規作成。
  * 誤ってプロジェクトファイルを壊してしまったため廃棄

----

ASIO is a trademark of Steinberg Media Technologies GmbH.